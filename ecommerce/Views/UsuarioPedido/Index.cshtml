@model List<ecommerce.Models.Pedido>

@{
    ViewData["Title"] = "Pedidos";
    int pagIndex = (int)(ViewData["PagIndex"] ?? 1);
    int totalPag = (int)(ViewData["TotalPag"] ?? 1);

    string ClienteNome() => Context.Session.GetString("UsuarioNome") ?? "—";
}

<section class="orders-wrap">
    <h6 class="orders-title">MEUS PEDIDOS</h6>

    <div class="orders-panel">
        <div class="table-responsive">
            <table class="table orders-table mb-0">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>CLIENTE</th>
                        <th>PRODUTO</th>
                        <th>CATEGORIA</th>
                        <th>PREÇO</th>
                        <th>TIPO PAGAMENTO</th>
                        <th>STATUS</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var p in Model)
                    {
                        var primeiroItem = p.Itens?.FirstOrDefault();
                        var prodNome = primeiroItem?.Produto?.Nome ?? "—";
                        var prodCat = primeiroItem?.Produto?.Categoria ?? "—";
                        var tipoPg = p.MetodoPagamento?.Descricao ?? "—";
                        var statusPg = (p.DataPagamento > DateTime.MinValue) ? "PAGO" : "PENDENTE";

                        <tr>
                            <td>@p.Id</td>
                            <td>@ClienteNome()</td>
                            <td class="prod-cell">
                                <div class="prod-name">@prodNome</div>
                            </td>
                            <td>@prodCat</td>
                            <td>R$ @p.ValorTotal.ToString("N2")</td>
                            <td>@tipoPg</td>
                            <td class="text-uppercase">@statusPg</td>
                            <td class="text-end">
                                <a class="pill-btn"
                                   asp-controller="UsuarioPedido"
                                   asp-action="Detalhes"
                                   asp-route-id="@p.Id">
                                    VER DETALHES
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    @if (totalPag > 1)
    {
        <nav class="orders-pagination">
            <ul class="pagination m-0">
                @for (int i = 1; i <= totalPag; i++)
                {
                    var ativo = i == pagIndex ? "active" : "";
                    <li class="page-item @ativo">
                        <a class="page-link" href="?pagIndex=@i">@i</a>
                    </li>
                }
            </ul>
        </nav>
    }
</section>

@section Styles {
    <style>
        :root{
          --bg:#f3ede1;        
          --panel:#efe5d6;    
          --ink:#1b1713;     
          --pill:#8b6248;      
          --shadow:0 8px 24px rgba(0,0,0,.10);
          --radius:16px;
        }

        .orders-wrap{ background:var(--bg); }
        .orders-title{
          margin: 10px 0 8px 12px;
          font-size:.9rem;
          letter-spacing:.08em;
          color:#6c635b;
        }

        .orders-panel{
          background:var(--panel);
          border-radius: var(--radius);
          box-shadow: var(--shadow);
          padding: 14px 16px;
        }

        .orders-table{
          color:var(--ink);
          margin-bottom:0;
          border-collapse:separate;
          border-spacing:0 16px;
        }

        .orders-table thead th{
          border:0;
          font-weight:700;
          text-transform:uppercase;
          letter-spacing:.06em;
          font-size:.85rem;
          color:#3b332d;
          padding:10px 12px;
        }

        .orders-table tbody tr{
          background:rgba(255,255,255,.35);
          box-shadow:0 2px 8px rgba(0,0,0,.06);
          border-radius:12px;
        }

        .orders-table tbody td{
          border:0 !important;
          padding:14px 12px;
          vertical-align:middle;
          color:#3b332d;
        }
        .orders-table tbody tr td:first-child{ border-top-left-radius:12px; border-bottom-left-radius:12px; }
        .orders-table tbody tr td:last-child { border-top-right-radius:12px; border-bottom-right-radius:12px; }

        .prod-cell .prod-name{
          font-family:"Cinzel","Cormorant Garamond",serif;
          line-height:1.15;
          letter-spacing:.06em;
          text-transform:uppercase;
          font-size:.95rem;
        }

        .pill-btn{
          display:inline-block;
          font-size:.75rem;
          letter-spacing:.04em;
          color:#fff !important;
          background:var(--pill);
          padding:.35rem .7rem;
          border-radius:999px;
          text-decoration:none;
          box-shadow: inset 0 -1px 0 rgba(0,0,0,.15);
        }
        .pill-btn:hover{ opacity:.95; color:#fff; }

        .orders-pagination{
          margin-top:12px;
        }
        .orders-pagination .page-link{
          border:0;
          background:transparent;
          color:#5b5148;
        }
        .orders-pagination .page-item.active .page-link{
          background:var(--pill);
          color:#fff;
          border-radius:999px;
        }
    </style>
}
